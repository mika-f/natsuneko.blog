---
title: Webpacker ã®ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã§ã® assets:precompile ã§ã“ã‘ã‚‹
date: 2018/01/14
basename: 2018/01/14/webpacker-production-assets-precompile-error
categories: ["Node.js"]
---

Rails 5.1 ä»¥ä¸Šã€ Webpacker ã‚’å°å…¥ã—ãŸç’°å¢ƒã§ã€ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰ã—ãŸéš›ã€ `assets:precompile` ã§çµæœãŒä½•ã‚‚å¸°ã£ã¦ã“ãªããªã‚Šã¾ã—ãŸã€‚

ã“ã‚“ãªæ„Ÿã˜ï¼š

```
01:00 deploy:assets:precompile
    01 $HOME/.rbenv/bin/rbenv exec bundle exec rake assets:precompile
    01 Webpacker is installed ğŸ‰ ğŸ°
    01 Using /home/mikazuki/cancer/releases/20180114021630/config/webpacker.yml file for setting up webpack paths
    01 Compiling...
```

ã“ã®çŠ¶æ…‹ã§ãšãƒ¼ãƒ¼ãƒ¼ã¨æ­¢ã¾ã£ã¦ã‚‹æ„Ÿã˜ã€‚  
èª¿ã¹ã¦ã¿ã‚‹ã¨ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ä¸­ã«ãƒ¡ãƒ¢ãƒªãŒè¶³ã‚Šãªããªã£ã¦æ­»ã‚“ã§ã‚‹ã¨ã®ã“ã¨ã€‚

ã¨ã„ã†ã“ã¨ã§ã€ Webpacker ãŒä½¿ãˆã‚‹ãƒ¡ãƒ¢ãƒªå®¹é‡ã‚’å¢—ã‚„ã™ã“ã¨ã§è§£æ±ºã—ã¾ã—ãŸã€‚

```diff
@@ bin/webpack
-cmd = [ "#{NODE_MODULES_PATH}/.bin/webpack", "--config", WEBPACK_CONFIG ] + ARGV
+cmd = [ "node", "--max_old_space_size=4096", "#{NODE_MODULES_PATH}/.bin/webpack", "--config", WEBPACK_CONFIG ] + ARGV
```

( `bin/webpack` ã‚’ã„ã˜ã£ã¦è§£æ±ºã•ã›ãŸã‘ã©ã€ã“ã‚Œã§ã„ã„ã®ã‹ã¯çŸ¥ã‚‰ãªã„)

å‚è€ƒ:

- [Compiling on staging/production takes too long/is too slow Â· Issue #1003 Â· rails/webpacker Â· GitHub](https://github.com/rails/webpacker/issues/1003)
- [Rails5.1 ã® bin/webpacker-dev-server ã§ JavaScript heap out of memory ãŒèµ·ããŸæ™‚ã®å¯¾å‡¦æ–¹ - Qiita](https://qiita.com/nmatsumoto4/items/cc73b796c78786430835)
- [Node.js ã§ FATAL ERROR: CALL_AND_RETRY_LAST Allocation failed - JavaScript heap out of memory - ã¿ã‹ã¥ããƒ¡ãƒ¢](http://mikazuki.hatenablog.jp/entry/2017/06/20/222312)
